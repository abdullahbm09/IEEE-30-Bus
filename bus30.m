% Power System Simulation Lab
% Ashish Kumar 16MT000947
% IEEE 30 BUS SYSTEM
%     Bus No    Vm    Theta    P       Q     Pl      Q1   Qmin   Qmax  Type
busdata= [ 1   1.05     0    138.48  -3.99   0        0       0      0   1;
           2  1.0338    0     57.56  -0.56  21.7   12.7     -20    60    2;
           3    1       0      0.0    0.0   2.4     1.2      0      0    3;
           4    1       0      0.0    0.0   7.6     1.6      0      0    3;
           5  1.0058    0     24.56   21.20  94.2  19.0    -15    62.5   2;
           6    1       0      0.0    0.0    0.0    0.0     0      0     3;
           7    1       0      0.0    0.0   22.8   10.9     0      0     3;
           8  1.0230    0     35.0   26.78  30.0   30.0    -15    50     2;
           9    1       0      0.0    0.0    0.0    0.0     0      0     3;
           10   1       0      0.0    0.0    5.8    2.0     0      0     3;
           11 1.0913    0     17.93  24.10   0.0    0.0    -10     40    2;
           12   1       0      0.0    0.0    11.2   7.5     0      0     3;
           13 1.0883    0     16.91  31.69   0.0    0.0    -15     45    2;
           14   1       0      0.0    0.0     6.2   1.6     0      0     3;
           15   1       0      0.0    0.0     8.2   2.5     0      0     3;
           16   1       0      0.0    0.0     3.5   1.8     0      0     3;
           17   1       0      0.0    0.0     9.0   5.8     0      0     3;
           18   1       0      0.0    0.0     3.2   0.9     0      0     3;
           19   1       0      0.0    0.0     9.5   3.4     0      0     3;
           20   1       0      0.0    0.0     2.2   0.7     0      0     3;
           21   1       0      0.0    0.0    17.5  11.2     0      0     3;
           22   1       0      0.0    0.0     0.0   0.0     0      0     3;
           23   1       0      0.0    0.0     3.2   1.6     0      0     3;
           24   1       0      0.0    0.0     8.7   6.7     0      0     3;
           25   1       0      0.0    0.0     0.0   0.0     0      0     3;
           26   1       0      0.0    0.0     3.5   2.3     0      0     3;
           27   1       0      0.0    0.0     0.0   0.0     0      0     3;
           28   1       0      0.0    0.0     0.0   0.0     0      0     3;
           29   1       0      0.0    0.0     2.4   0.9     0      0     3;
           30   1       0      0.0    0.0     10.6  1.9     0      0     3];

 %shuntcapacitance
  shuntdata=[0 0 0 0 0 0 0 0 0 sqrt(-1)*0.19 0 0 0 0 0 0 0 0 0 0 0 0 0 sqrt(-1)*.04 0 0 0 0 0 0]';
 
 %linedata
 %      Line No  From To     R     X     B/2     T
 linedata=[ 1     1   2    0.0192  0.0575  0.0264 1;
            2     1   3    0.0452  0.1852  0.0204 1;
            3     2   4    0.0570  0.1737  0.0184 1;
            4     3   4    0.0132  0.0379  0.0042 1;
            5     2   5    0.0472  0.1983  0.0209 1;
            6     2   6    0.0581  0.1763  0.0187 1;
            7     4   6    0.0119  0.0414  0.0045 1;
            8     5   7    0.0460  0.1160  0.0820 1;
            9     6   7    0.0267  0.0820  0.0085 1;
            10    6   8    0.0120  0.0420  0.0043 1;
            11    6   9     0.0    0.2080   0.0   1.0155;
            12    6   10    0.0    0.5560   0.0   0.9629;
            13    9   11    0.0    0.2080   0.0   1;
            14    9   10    0.0    0.5560   0.0   1;
            15    4   12    0.0    0.2080   0.0   1.0129;
            16    12  13    0.0    0.5560   0.0   1;
            17    12  14   0.1231  0.2559   0.0   1;
            18    12  15   0.0662  0.1304   0.0   1;
            19    12  16   0.0945  0.1987   0     1;
            20    14  15   0.0662  0.1304   0     1;
            21    16  17   0.0824  0.1932   0     1;
            22    15  18   0.1070  0.2185   0     1;
            23    18  19   0.0639  0.1292   0     1;
            24    19  20   0.0340  0.0680   0     1;
            25    10  20   0.0936  0.2090   0     1;
            26    10  17   0.0324  0.0845   0     1;
            27    10  21   0.0348  0.0749   0     1;
            28    10  22   0.0727  0.1499   0     1;
            29    21  22   0.0116  0.0236   0     1;
            30    15  23   0.100   0.2020   0     1;
            31    22  24   0.1150  0.1790   0     1;
            32    23  24   0.1320  0.2700   0     1;
            33    24  25   0.1885  0.3292   0     1;
            34    25  26   0.2544  0.3800   0     1;
            35    25  27   0.1093  0.2087   0     1;
            36    27  28   0       0.3960   0   0.9581;
            37    27  29   0.2198  0.4153   0     1;
            38    27  30   0.3202  0.6027   0     1;
            39    29  30   0.2399  0.4533   0     1;
            40    8   28   0.0636  0.200  0.0214  1;
            41    6   28   2.0169  0.0599  0.0065 1];
      
% Ybus program
fb = linedata(:,2);
tb = linedata(:,3);
R =  linedata(:,4);
X =  linedata(:,5);
B =  linedata(:,6);
T =  linedata(:,7);
z =  R+sqrt(-1)*X;
y = 1./z;
b= sqrt(-1)*B;
nbus = max(max(fb),max(tb)); % no of bus
nbranch = length(fb); % no of branch
Y = zeros(nbus,nbus); % initialise Ybus

%formation of offdiagonal element
for k=1: nbranch
    Y(fb(k),tb(k))= Y(fb(k),tb(k))-y(k)/T(k);
    Y(tb(k),fb(k))=Y(fb(k),tb(k));
end

%formation of diagonal element
for m=1 : nbus
    for n = 1:nbranch
        if fb(n)== m
            Y(m,m)= Y(m,m)+(y(n)/(T(k)^2))+b(n);
        elseif tb(n)== m
            Y(m,m)= Y(m,m)+y(n)+b(n);
        end
    end 
end

%entry of shuntdata in IEEE 30 Bus system
for i = 1:30       
     Y(i,i)= Y(i,i)+ shuntdata(i);
end

